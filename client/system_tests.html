<!DOCTYPE HTML>
<html>
<head>
  <title>-- Systems Tests --</title>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #000000;
    }
  </style>
  
  <script src="deps/pixi-js/bin/pixi.dev.js"></script>
  <script src="deps/js-signals.git/dist/signals.js"></script>

  <script src="src/engine/utils.js"></script>
  <script src="src/engine/graphics.js"></script>
  <script src="src/engine/component.js"></script>
  <script src="src/engine/entity.js"></script>
  <script src="src/engine/world.js"></script>
  <script src="src/engine/game.js"></script>
  <script src="src/engine/system.js"></script>
  <script src="src/engine/system_node_list.js"></script>
  
</head>
<body>
  <script>

  	// -- Test Components
  	var Animal = new Class({Extends:Component});
  	var Cat = new Class({Extends:Animal, initialize:function(){var a = 5}});
  	var Dog = new Class({Extends:Animal});
  	var Shoes = new Class({Extends:Component});
  	var Socks = new Class({Extends:Component});

  	// -- Helper Functions
  	var numNodesInSystem = function(system)
  	{
  		var num = 0;
  		system.nodeLists.each(function(nodeList){
  			num += nodeList.nodes.length;
  		});
  		return num;
  	};

  	var newEntity = function(components)
  	{
  		var componentMap = {};
  		for (var i = 0; i < components.length; ++i)
  		{
  			componentMap[i.toString()] = new components[i];
  		}
      return game.world.addEntity(new Entity({components:componentMap}));
  	};

  	// -- Setup
  	game.initialize();

  	newEntity([]);
  	newEntity([Animal,Shoes]);
  	newEntity([Cat,Shoes]);
  	newEntity([Cat]);

  	var system = new System();
  	system.createNodeList({
  		animal:Animal,
  		shoes:Shoes
  	});
  	game.addSystem(system);

  	assert(numNodesInSystem(system) == 2);

    var entity = newEntity([Animal,Shoes]);
    assert(numNodesInSystem(system) == 3);

    entity.removeComponentByName("0");
    assert(numNodesInSystem(system) == 2);

    entity.addComponent("animal",new Animal());
    assert(numNodesInSystem(system) == 3);

  </script>
  </body>
</html>
